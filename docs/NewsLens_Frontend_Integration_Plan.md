## Outcome

A production-grade front-end application that:

* Renders and filters historical news snapshot data by date, source, and time slot
* Displays full-resolution images and headlines in a responsive, accessible grid
* Offers detailed modal views with sentiment and navigation
* Supports advanced UX features like search, filtering, and timeline playback
* Integrates modular, typed API calls using `react-query`
* Provides clean, testable, and well-commented components
* **Is modular, testable, and validated end-to-end**

---

# Integration Progress Update (2024-05-07)

- The backend now provides a dynamic `/api/sources` endpoint with all canonical source metadata, seeded from MongoDB.
- The frontend has deleted `mockData.ts` and is now integrating dynamic source fetching from the backend for all grid and control logic.
- All hardcoded source data is being removed; all references to `mockData.ts` in the prototype must be audited and updated to use the new sources API.
- **Current status:** Integrating the frontend to use the new sources API for all source metadata, grid, and controls.
- **Next steps:** Complete the audit, update all components, and test the dynamic integration.

---

# NewsLens Frontend Integration Plan

This document outlines the implementation steps to integrate the existing frontend prototype with the live backend snapshot API for NewsLens. The integration uses `react-query`, `axios`, and fully typed TypeScript interfaces to ensure maintainability and performance.

---

## üìä Component Integration: NewsGrid + NewsCell + NewsDetail

### `NewsGrid.tsx`

**Responsibilities**:

* Renders a `sources x timeSlots` matrix
* Matches snapshots using:

  ```ts
  snapshot.short_id === source.short_id && snapshot.id.endsWith(`-${slot.id}`)
  ```
* Applies `searchQuery` to `mainHeadline` and `subHeadlines`
* Renders either:

  * `NewsCell` if snapshot exists and matches filter
  * "No data" or "No match" placeholders
* Launches `NewsDetail` modal on click

**Prop interface**:

```ts
interface NewsGridProps {
  snapshots: NewsSnapshot[];
  sources: NewsSource[];
  timeSlots: TimeSlot[];
  searchQuery: string;
}
```

**Milestones**:

* [ ] Confirm grid renders all valid snapshot cells
* [ ] Confirm filtering logic works with text search
* [ ] Confirm modal detail navigation functions as expected

---

### `NewsCell.tsx`

**Responsibilities**:

* Thumbnail card preview of a snapshot
* Renders:

  * `mainHeadline` and `subHeadlines`
  * Screenshot thumbnail (`thumbnailUrl`)
  * Source badge (from `source.color`)
  * Sentiment bar (`score`, `magnitude`)
* Applies hover overlay for details

**Prop interface**:

```ts
interface NewsCellProps {
  snapshot: NewsSnapshot;
  source: NewsSource;
  onClick: () => void;
}
```

**Milestones**:

* [ ] Confirm thumbnail renders image and sentiment UI
* [ ] Confirm headline overlay appears on hover
* [ ] Confirm cell is clickable and launches detail modal

---

### `NewsDetail.tsx`

**Responsibilities**:

* Full-page overlay for selected snapshot
* Renders:

  * Source name and timestamp
  * `mainHeadline` and `subHeadlines`
  * Full-size image (`fullImageUrl`)
  * Sentiment badge with icon + label
* Provides prev/next navigation

**Prop interface**:

```ts
interface NewsDetailProps {
  snapshot: NewsSnapshot;
  source: NewsSource;
  onClose: () => void;
  onPrevious?: () => void;
  onNext?: () => void;
  hasPrevious: boolean;
  hasNext: boolean;
}
```

**Milestones**:

* [ ] Confirm modal displays all snapshot content correctly
* [ ] Confirm prev/next navigation is responsive
* [ ] Confirm close button and ESC behavior work

---

### Notes on Data Consistency

* `snapshot.id` is generated by the backend as `${short_id}-${timeSlot}` and is safe to rely on for all grid-matching logic.
* `thumbnailUrl` and `fullImageUrl` are actively used in `NewsCell` and `NewsDetail` respectively and must be present in API responses.
* `sentiment.score` and `sentiment.magnitude` are required for rendering the UI sentiment bar and badge.
* Ensure backend continues to provide these fields consistently, even if null, to avoid rendering errors.

---

### Source Key Explanation

- `short_id` is the canonical, human-readable, and stable key for each news source (e.g., 'cnn', 'foxnews').
- `short_id` is used for all matching and filtering in both backend and frontend.
- `_id` (or `id`) is the MongoDB ObjectId and is only used for database operations, not for business logic or matching in the UI.

---

## üéõÔ∏è Component Integration: Controls (Sidebar)

### üìÅ Suggested Directory Structure

To ensure modularity and enable Cursor Copilot compatibility, separate the sidebar logic into dedicated subcomponents under a `Controls/` directory:

```bash
frontend/src/components/Controls/
‚îú‚îÄ‚îÄ Controls.tsx            # Wrapper layout with vertical stacking
‚îú‚îÄ‚îÄ SourceToggleList.tsx    # Renders toggle list of news sources
‚îú‚îÄ‚îÄ SourceToggleItem.tsx    # Renders one toggle with color and name
‚îú‚îÄ‚îÄ SearchInput.tsx         # Text input for headline filtering
‚îú‚îÄ‚îÄ DateSelector.tsx        # Calendar-based selector (DayPicker)
```

Each subcomponent should have its own clear prop types and optional test files alongside:

```bash
‚îú‚îÄ‚îÄ __tests__/
‚îÇ   ‚îú‚îÄ‚îÄ SourceToggleItem.test.tsx
‚îÇ   ‚îú‚îÄ‚îÄ DateSelector.test.tsx
```

---

### `Controls.tsx`

**Responsibilities**:

* Display a list of toggleable news sources with color indicators
* Allow toggling all sources on/off via a single button
* Provide a text input for filtering grid headlines by keyword

**Prop interface**:

```ts
interface ControlsProps {
  sources: NewsSource[];
  activeSourceIds: string[];
  onToggleSource: (id: string) => void;
  onToggleAllSources: (showAll: boolean) => void;
  searchQuery: string;
  onSearchQueryChange: (value: string) => void;
}
```

**Milestones**:

* [ ] Verify toggling individual sources filters the grid
* [ ] Verify "Show All" / "Hide All" reflects correct toggle state
* [ ] Verify search input filters content in `NewsGrid`

---

## üìÖ Date Picker Integration

The prototype currently uses a static date. Replace this with a dynamic date picker using a lightweight library like `react-day-picker`.

### Implementation Steps:

1. Install:

   ```bash
   npm install react-day-picker
   ```

2. In your `Controls.tsx` or `Home.tsx`, add:

   ```tsx
   import { DayPicker } from 'react-day-picker';
   import 'react-day-picker/dist/style.css';
   ```

3. Accept new props:

   ```ts
   selectedDate: Date;
   onDateChange: (date: Date) => void;
   ```

4. Add component:

   ```tsx
   <DayPicker
     mode="single"
     selected={selectedDate}
     onSelect={onDateChange}
     footer={<p>Snapshots shown for {selectedDate.toDateString()}</p>}
   />
   ```

**Milestones**:

* [ ] Confirm new date triggers `useNewsSnapshots(date)` with formatted `YYYY-MM-DD`
* [ ] Confirm grid refreshes without full reload
* [ ] Confirm default state matches today's date

---

## üìà Analysis Page (Planned Feature)

The `Analysis.tsx` component is a version 2 feature designed to visualize insights and patterns across the dataset. It will include:

* Word frequency trends via word clouds
* Sentiment over time
* Clusters/themes of language by source and time
* Top words by time slot or source

Currently this file is scaffolded with placeholder components and mock data. It will be connected to real data in a future milestone.

---

## üß≠ Routing Strategy

### Route Design

NewsLens is a single-page application (SPA) using React Router v6. All routes map to client-rendered views with deep linking support.

```tsx
<BrowserRouter>
  <Routes>
    <Route path="/" element={<Navigate to={`/${todayDate}`} />} />
    <Route path="/:date" element={<Home />} />
    <Route path="/analysis" element={<Analysis />} />
    {/* Future: */}
    {/* <Route path="/clusters" element={<Clusters />} /> */}
  </Routes>
</BrowserRouter>
```

### `Home.tsx` Integration

Use `useParams()` to read the route's date:

```tsx
const { date } = useParams();
const parsedDate = new Date(date || today());
```

Use `useNavigate()` to change route when user selects a new date:

```tsx
const navigate = useNavigate();

onDateChange={(newDate) => {
  const newPath = `/${format(newDate, 'yyyy-MM-dd')}`;
  navigate(newPath);
}}
```

### Directory Convention

Use `src/routes/` for clarity, and **deprecate the current `pages/` folder**. Create one file per route:

```bash
frontend/src/routes/
‚îú‚îÄ‚îÄ Home.tsx       # Route: /:date
‚îú‚îÄ‚îÄ Analysis.tsx   # Route: /analysis
‚îú‚îÄ‚îÄ NotFound.tsx   # Future: wildcard
```

Update imports in `App.tsx` accordingly.

---

## üé® Theming & Visual Style

### Goals

* Support light and dark mode
* Ensure WCAG AA accessibility (color contrast, keyboard navigation)
* Use Tailwind's theme system for flexibility

### Recommended Implementation

1. **Enable Dark Mode in Tailwind Config**:

   ```js
   // tailwind.config.js
   module.exports = {
     darkMode: 'class', // or 'media'
     theme: {
       extend: {
         colors: {
           primary: '#2563eb',
           accent: '#f59e0b',
         },
       },
     },
     plugins: [],
   };
   ```

2. **Create a theme toggle (optional)**:

   * Place inside `Header.tsx` or as a global `ThemeToggle.tsx`.
   * Use `document.documentElement.classList.toggle('dark')` to switch.

3. **Use Tailwind's `dark:` variants** in components:

   ```tsx
   <div className="bg-white dark:bg-zinc-900 text-black dark:text-white">...</div>
   ```

4. **Add baseline styles** in `index.css`:

   ```css
   html {
     @apply bg-white text-black;
   }
   html.dark {
     @apply bg-zinc-900 text-white;
   }
   ```

### Milestones

* [ ] Confirm layout renders consistently in both themes
* [ ] Add visual regression tests or snapshots for dark mode
* [ ] Add user preference toggle for theme (optional)

---

## üöÄ Performance Optimization

### Should We Load All Images at Once?

Currently, all snapshots for a given day are fetched at once via a single API call. This is acceptable for 25‚Äì50 images per day, but performance and UX can be improved.

**Recommended approach:**

* ‚úÖ **Fetch all metadata upfront** via the `/api/snapshots?date=...` API call.
* ‚úÖ **Render a full 5√ó5 grid immediately**, using metadata to populate cells.
* üöÄ **Defer image rendering** using lazy loading + skeleton loaders.

### Implementation Recommendations

#### 1. Add `loading="lazy"` to `<img>` tags in `NewsCell.tsx`

```tsx
<img
  loading="lazy"
  src={snapshot.thumbnailUrl}
  alt="Headline screenshot"
  className="object-cover w-full h-full"
/>
```

#### 2. Create a `SkeletonCell.tsx` placeholder

* Shows a shimmer effect using Tailwind animations
* Replaces image when `thumbnailUrl` is not loaded

#### 3. Add conditional logic in `NewsCell.tsx`

```tsx
{thumbnailUrl ? (
  <img src={...} ... />
) : (
  <SkeletonCell />
)}
```

#### 4. Optional: Use [IntersectionObserver](https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API) for more precise lazy loading if grid grows beyond 25‚Äì50 cells.

### Milestones

* [ ] Confirm shimmer placeholder renders for all cells before image loads
* [ ] Verify image loading does not block grid paint
* [ ] Benchmark with ~50 snapshots across different connections

---

## ‚ùó Error Handling & Empty States

### Key Scenarios to Handle

* ‚ùå **Network failure** during API call (`useNewsSnapshots`)
* ‚ö†Ô∏è **No snapshots found** for selected date
* üì¥ **Image load failure** for individual `thumbnailUrl`

### Implementation Suggestions

#### 1. API Load Errors (`Home.tsx`)

Use `react-query`'s `isError` state:

```tsx
{isError && (
  <div className="text-center text-red-600 py-12">
    Failed to load snapshots. Please try a different date or refresh the page.
  </div>
)}
```

#### 2. No Data Case

If snapshots array is empty:

```tsx
{snapshots.length === 0 && !isLoading && !isError && (
  <div className="text-center text-gray-500 py-12">
    No snapshots found for this date.
  </div>
)}
```

#### 3. Broken Image URLs

In `NewsCell.tsx`, handle image fallback:

```tsx
<img
  src={snapshot.thumbnailUrl}
  onError={(e) => {
    e.currentTarget.src = "/fallback-thumbnail.jpg";
  }}
  alt="Headline thumbnail"
  className="..."
/>
```

> Consider creating a shared `ImageWithFallback.tsx` component if reused across `NewsCell` and `NewsDetail`

### Milestones

* [ ] Confirm proper error message appears on API failure
* [ ] Confirm fallback UI renders for empty snapshot days
* [ ] Confirm broken image URLs are replaced gracefully

---

## üö´ Not Found (404) Handling

### Use Case

When a user navigates to an undefined route (e.g. `/wrong-url`), they should see a friendly 404 page.

### Recommended Implementation

1. **Create `NotFound.tsx` in `src/routes/`**

```tsx
import { useNavigate } from 'react-router-dom';

export default function NotFound() {
  const navigate = useNavigate();

  return (
    <div className="flex flex-col items-center justify-center h-screen text-center p-8">
      <h1 className="text-4xl font-bold text-gray-700 mb-4">404 ‚Äì Page Not Found</h1>
      <p className="text-gray-500 mb-6">Sorry, we couldn't find that page.</p>
      <button
        onClick={() => navigate('/')}
        className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
      >
        Return to Home
      </button>
    </div>
  );
}
```

2. **Add wildcard route to `App.tsx`**:

```tsx
<Route path="*" element={<NotFound />} />
```

### Milestones

* [ ] Confirm unknown paths redirect to NotFound page
* [ ] Ensure consistent styling with rest of app

---

## üìé Appendix: Core Types & Data Contract

### /api/snapshots Response Contract

Each snapshot object returned by the backend has the following fields:

```
{
  id: string,              // Format: `${short_id}-${timeSlot}`
  short_id: string,        // Canonical string source key (e.g., 'cnn')
  timestamp: string,       // ISO date string
  mainHeadline: string,    // Main headline text
  subHeadlines: string[],  // Array of sub-headline strings
  imageUrl: string,        // [DEPRECATED] Use fullImageUrl instead
  thumbnailUrl: string,    // Presigned S3 URL for thumbnail image
  fullImageUrl: string,    // Presigned S3 URL for full-size image
  sentiment: {
    score: number,         // Sentiment score (placeholder)
    magnitude: number      // Sentiment magnitude (placeholder)
  }
}
```

- `fullImageUrl` should be used for all full-size image displays (e.g., NewsDetail modal).
- `thumbnailUrl` should be used for grid/cell thumbnails.
- `imageUrl` is maintained for backward compatibility but will be removed in the future.

---

## üìÜ Next Steps

* [ ] Add unit tests for `NewsCell` rendering and sentiment bar
* [ ] Add integration tests for grid filtering behavior
* [ ] Add accessibility roles/labels for modal and thumbnails
* [ ] Add fallback image handling for broken S3 URLs

---

### API Integration Checklist

- [x] Use @tanstack/react-query for all data fetching
- [x] Create a QueryClient instance in src/main.tsx
- [x] Wrap <App /> in <QueryClientProvider client={queryClient}> at the root
- [x] All custom hooks (e.g., useNewsSnapshots) require this provider
- [ ] If you see 'No QueryClient set, use QueryClientProvider to set one', ensure the provider is present at the root

---

## Time Slot Configuration: Canonical Source

- The canonical list of daily time slots is defined in the backend at `backend/config/base.py` as `DEFAULT_CAPTURE_TIMES`:

  ```python
  DEFAULT_CAPTURE_TIMES = [
      "06:00",
      "09:00",
      "12:00",
      "15:00",
      "18:00"
  ]
  ```

- The frontend must maintain a matching constant in `frontend/src/constants/timeSlots.ts`:

  ```ts
  export const STANDARD_TIME_SLOTS = [
    { id: '06:00', label: '6:00 AM' },
    { id: '09:00', label: '9:00 AM' },
    { id: '12:00', label: '12:00 PM' },
    { id: '15:00', label: '3:00 PM' },
    { id: '18:00', label: '6:00 PM' },
  ];
  ```

- **Important:** If you update the time slots in one place, update the other to match. Add a comment referencing the other location to prevent config drift.

---
